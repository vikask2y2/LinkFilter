<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Link Filter</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #f2effc;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 40px 0;
    margin: 0;
  }

  .container {
    width: 750px;
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 30px;
  }

  h2 {
    text-align: center;
    font-weight: 600;
    color: #3e2b84;
    margin-bottom: 20px;
  }

  .input-wrap {
    position: relative;
  }

  textarea {
    width: 100%;
    height: 120px;
    border: 1px solid #d6ccf2;
    border-radius: 10px;
    padding: 12px 40px 12px 12px;
    font-size: 14px;
    resize: none;
    display: block;
    margin: 0 auto;
    box-sizing: border-box;
  }

  /* Paste icon styling */
  .paste-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none !important;
    border: none;
    color: #7b5af5;
    cursor: pointer;
    font-size: 18px;
    padding: 5px 10px;
    transition: color 0.2s ease;
  }

  .paste-btn:hover,
  .paste-btn:focus {
    background: none !important;
    color: #5a3fcf;
  }

  .paste-btn i {
    pointer-events: none;
  }

  select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #d6ccf2;
    margin-top: 10px;
    font-size: 14px;
    background-color: #f8f6ff;
  }

  /* Top button group */
  .buttons {
    display: flex;
    justify-content: space-between;
    margin: 15px 0;
  }

  /* Apply default style to all 3 top buttons */
  .buttons button {
    flex: 1;
    margin: 0 5px;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
  }

  /* Restore proper colors */
  .clear-btn {
    background-color: #e74c3c;
  }
  .clear-btn:hover {
    background-color: #d73828;
  }

  .buttons button:nth-child(2) {
    background-color: #7b5af5; /* Download button purple */
  }
  .buttons button:nth-child(2):hover {
    background-color: #6c4ee6;
  }

  .copy-all {
    background-color: #5ec47b;
  }
  .copy-all:hover {
    background-color: #4dbb69;
  }

  .results {
    margin-top: 20px;
  }

  .link-item {
    background-color: #f8f6ff;
    border: 1px solid #e0dbfa;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
  }

  .link-number {
    font-weight: 600;
    color: #5a4dbf;
    margin-right: 10px;
  }

  .link-url {
    flex: 1;
    overflow-wrap: anywhere;
    color: #333;
  }

  /* Single copy button (rectangular like download) */
  .copy-btn {
    background: #7b5af5;
    color: #fff;
    border: none;
    border-radius: 8px;
    width: 70px;
    height: 42px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    flex: none !important;
  }

  .copy-btn:hover {
    background: #6c4ee6;
  }

  .copy-btn.copied {
    background: #5ec47b;
  }

  .copy-status {
    text-align: center;
    font-size: 14px;
    color: #2d7a32;
    margin-top: 5px;
    height: 18px;
  }

  /* Open button added beside copy button */
  .open-btn {
    background: #28a8e0;
    color: #fff;
    border: none;
    border-radius: 8px;
    width: 70px;
    height: 42px;
    margin-right: 10px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    flex: none !important;
  }
  .open-btn:hover {
    background: #1a8fc4;
  }

  /* Opened state - permanent red like copy */
  .open-btn.opened {
    background: #e74c3c !important;
  }
  .open-btn.opened:hover {
    background: #c0392b !important;
  }
</style>
</head>
<body>
<div class="container">
  <h2>Link Filter Tool</h2>

  <div class="input-wrap">
    <textarea id="inputLinks" placeholder="Paste all your links here..."></textarea>
    <button class="paste-btn" id="pasteBtn"><i class="fa-solid fa-paste"></i></button>
  </div>

  <select id="domainSelect">
    <option value="">-- Select a domain to filter --</option>
  </select>

  <div class="buttons">
    <button class="clear-btn" onclick="clearAll()">Clear All</button>
    <button onclick="downloadFiltered()">Download (.txt)</button>
    <button class="copy-all" id="copyAllBtn" onclick="copyAll()">Copy Links</button>
  </div>

  <div class="copy-status" id="copyStatus"></div>
  <div class="results" id="results"></div>
</div>

<script>
  const inputBox = document.getElementById("inputLinks");
  const domainSelect = document.getElementById("domainSelect");
  const resultsBox = document.getElementById("results");
  const copyAllBtn = document.getElementById("copyAllBtn");
  const pasteBtn = document.getElementById("pasteBtn");

  let filteredLinks = [];
  let domainLinks = {};
  let copiedLinks = new Set(); // Track copied links globally
  let openedLinks = new Set(); // Track opened links permanently

  inputBox.addEventListener("input", updateDomains);
  domainSelect.addEventListener("change", filterLinks);

  pasteBtn.addEventListener("click", async () => {
    try {
      const text = await navigator.clipboard.readText();
      inputBox.value = text;
      updateDomains();
    } catch {
      alert("Clipboard permission denied or not supported.");
    }
  });

  function updateDomains() {
    const text = inputBox.value.trim();
    const links = text.split(/\s+/).filter(l => l.startsWith("http"));
    const domains = {};
    links.forEach(link => {
      try {
        const hostname = new URL(link).hostname;
        if (!domains[hostname]) domains[hostname] = [];
        domains[hostname].push(link);
      } catch {}
    });
    domainLinks = domains;
    domainSelect.innerHTML = '<option value="">-- Select a domain to filter --</option>';
    Object.keys(domains).forEach(domain => {
      const opt = document.createElement("option");
      opt.value = domain;
      opt.textContent = `${domain} (${domains[domain].length})`;
      domainSelect.appendChild(opt);
    });
    resultsBox.innerHTML = "";
    updateCopyAllCount(0);
  }

  function filterLinks() {
    const domain = domainSelect.value;
    if (!domain) return;
    filteredLinks = domainLinks[domain] || [];
    displayLinks(filteredLinks);
    updateCopyAllCount(filteredLinks.length);
  }

  function displayLinks(links) {
    resultsBox.innerHTML = "";
    if (links.length === 0) {
      resultsBox.innerHTML = "<p>No links found for this domain.</p>";
      return;
    }
    links.forEach((link, index) => {
      const div = document.createElement("div");
      div.classList.add("link-item");
      const isCopied = copiedLinks.has(link); // check if link is copied already
      const isOpened = openedLinks.has(link); // check if link was opened already
      div.innerHTML = `
        <span class="link-number">${index + 1}.</span>
        <span class="link-url">${link}</span>

        <button class="open-btn ${isOpened ? 'opened' : ''}" title="Open link">
          <i class="${isOpened ? 'fa-solid fa-check' : 'fa-solid fa-up-right-from-square'}"></i>
        </button>

        <button class="copy-btn ${isCopied ? 'copied' : ''}" title="Copy link">
          <i class="${isCopied ? 'fa-solid fa-check' : 'fas fa-copy'}"></i>
        </button>
      `;
      const btn = div.querySelector(".copy-btn");
      btn.addEventListener("click", async () => {
        await navigator.clipboard.writeText(link);
        copiedLinks.add(link); // remember it
        btn.innerHTML = '<i class="fa-solid fa-check"></i>';
        btn.classList.add("copied");
      });

      // add listener for open button (new)
      const openBtn = div.querySelector(".open-btn");
      openBtn.addEventListener("click", () => {
        window.open(link, "_blank");
        // mark as opened permanently and update UI
        openedLinks.add(link);
        openBtn.innerHTML = '<i class="fa-solid fa-check"></i>';
        openBtn.classList.add("opened");
      });

      resultsBox.appendChild(div);
    });
  }

  function clearAll() {
    inputBox.value = "";
    domainSelect.innerHTML = '<option value="">-- Select a domain to filter --</option>';
    resultsBox.innerHTML = "";
    filteredLinks = [];
    domainLinks = {};
    copiedLinks.clear(); // clear when user clicks Clear All
    openedLinks.clear(); // clear opened state as well
    updateCopyAllCount(0);
  }

  function updateCopyAllCount(count) {
    copyAllBtn.textContent = count > 0 ? `Copy Links (${count})` : "Copy Links";
  }

  async function copyAll() {
    if (filteredLinks.length === 0) return;
    await navigator.clipboard.writeText(filteredLinks.join("\n"));
    filteredLinks.forEach(link => copiedLinks.add(link)); // mark all as copied
    displayLinks(filteredLinks); // refresh display to show checkmarks
    const originalText = copyAllBtn.textContent;
    copyAllBtn.textContent = "Copied!";
    setTimeout(() => (copyAllBtn.textContent = originalText), 1500);
  }

  function downloadFiltered() {
    if (filteredLinks.length === 0) return;
    const domain = domainSelect.value.replace(/\\./g, "_");
    const blob = new Blob([filteredLinks.join("\\n")], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${domain}_links.txt`;
    a.click();
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>
